# ะะฑะทะพั Pipeline ะะฑัะฐะฑะพัะบะธ ะธ ะะฝะดะตะบัะฐัะธะธ ะะพะบัะผะตะฝัะพะฒ SurfSense

## ะะฒะตะดะตะฝะธะต

SurfSense - ััะพ ะธะฝัะตะปะปะตะบััะฐะปัะฝะฐั ัะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั ะทะฝะฐะฝะธัะผะธ, ะบะพัะพัะฐั ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะพะบัะผะตะฝัั ะธะท ัะฐะทะปะธัะฝัั ะธััะพัะฝะธะบะพะฒ, ะธะทะฒะปะตะบะฐะตั ัะตะผะฐะฝัะธัะตัะบะธะต ะบะพะฝัะตะฟัะธะธ ะธ ะฟัะตะดะพััะฐะฒะปัะตั AI-powered ะฟะพะธัะบ ะธ ะธััะปะตะดะพะฒะฐัะตะปััะบะธะต ะฒะพะทะผะพะถะฝะพััะธ ัะตัะตะท ัะทัะบะพะฒัั ะฐะณะตะฝัะพะฒ.

## ะััะธัะตะบัััะฝัะน ะพะฑะทะพั

Pipeline ะพะฑัะฐะฑะพัะบะธ ะดะพะบัะผะตะฝัะพะฒ ะฒ SurfSense ะฟะพัััะพะตะฝ ะฝะฐ ัะปะตะดัััะธั ะบะปััะตะฒัั ะฟัะธะฝัะธะฟะฐั:

1. **ะะฝะพะณะพะธััะพัะฝะธะบะพะฒะฐั ะธะฝัะตะณัะฐัะธั** - ะฟะพะดะดะตัะถะบะฐ ัะฐะนะปะพะฒ, ะฒะตะฑ-ัััะฐะฝะธั ะธ 15+ ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ
2. **ะกะตะผะฐะฝัะธัะตัะบะฐั ะธะฝะดะตะบัะฐัะธั** - ะฒะตะบัะพัะฝัะต ะฟัะตะดััะฐะฒะปะตะฝะธั ะบะพะฝัะตะฝัะฐ ะดะปั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ
3. **ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ** - ะบะพะผะฑะธะฝะฐัะธั vector search ะธ full-text search ั RRF (Reciprocal Rank Fusion)
4. **AI-ะฐะณะตะฝัะฝะฐั ะฐััะธัะตะบัััะฐ** - ะธัะฟะพะปัะทะพะฒะฐะฝะธะต LangGraph ะดะปั orchestration ัะทัะบะพะฒัั ะผะพะดะตะปะตะน
5. **ะะพะฝัะตะฟััะฐะปัะฝัะน ัะปะพะน** - ะธะทะฒะปะตัะตะฝะธะต ะธ ััััะบัััะธัะพะฒะฐะฝะธะต ะทะฝะฐะฝะธะน ะฝะฐ ััะพะฒะฝะต ะบะพะฝัะตะฟัะธะน

## ะัะฝะพะฒะฝัะต ััะฐะฟั Pipeline

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    SURFSENSE DOCUMENT PIPELINE                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

   ๐ฅ INGESTION          ๐ ETL               ๐ PROCESSING
   โโโโโโโโโโโโโ         โโโโโโโโโ            โโโโโโโโโโโโโโ
   โข Files               โข Unstructured       โข Hash Generation
   โข URLs                โข LlamaCloud         โข Deduplication
   โข Connectors          โข Docling            โข Summary Generation
   โข Audio โ STT         โ Markdown           โข Metadata Extraction

   โ                     โ                    โ

   ๐งฉ CHUNKING           ๐ข EMBEDDINGS        ๐พ STORAGE
   โโโโโโโโโโโโโ         โโโโโโโโโโโโโ        โโโโโโโโโโ
   โข RecursiveChunker    โข Document-level     โข PostgreSQL
   โข CodeChunker         โข Chunk-level        โข pgvector
   โข Adaptive sizing     โข 1536-3072 dims     โข Relationships

   โ                     โ                    โ

   ๐ SEARCH             ๐ฏ RERANKING         ๐ค AI AGENTS
   โโโโโโโโโโโโโ         โโโโโโโโโโโโโ        โโโโโโโโโโโโโโ
   โข Vector Search       โข Cohere             โข Researcher Agent
   โข Full-Text Search    โข Pinecone           โข Q&A SubAgent
   โข Hybrid RRF          โข Score Update       โข LangGraph Workflow

   โ                     โ                    โ

                    ๐ ะะะะฃะะฌะขะะข
                    โโโโโโโโโโโโโ
                    โข ะัะฒะตั ั ัะธัะธัะพะฒะฐะฝะธัะผะธ
                    โข ะััะพัะฝะธะบะธ ะดะพะบัะผะตะฝัะพะฒ
                    โข Follow-up ะฒะพะฟัะพัั
```

## ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั

### 1. Document Processing Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/tasks/document_processors/`
- **ะคัะฝะบัะธั**: ETL ะพะฑัะฐะฑะพัะบะฐ, ะบะพะฝะฒะตััะฐัะธั ะฒ Markdown, ะดะตะดัะฟะปะธะบะฐัะธั
- **ะะปััะตะฒะพะน ัะฐะนะป**: `file_processors.py`

### 2. Graph Architecture Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/agents/researcher/`
- **ะคัะฝะบัะธั**: LangGraph workflow ะดะปั orchestration AI ะฐะณะตะฝัะพะฒ
- **ะะปััะตะฒะพะน ัะฐะนะป**: `graph.py`, `state.py`

### 3. Semantic Processing Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/utils/document_converters.py`
- **ะคัะฝะบัะธั**: ะะตะฝะตัะฐัะธั summary, ะธะทะฒะปะตัะตะฝะธะต ะบะพะฝัะตะฟัะธะน, ะพะฟัะธะผะธะทะฐัะธั ะบะพะฝัะตะฝัะฐ
- **ะะปััะตะฒัะต ััะฝะบัะธะธ**: `generate_document_summary()`, `create_document_chunks()`

### 4. Embeddings & Search Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/retriver/`
- **ะคัะฝะบัะธั**: ะะตะบัะพัะธะทะฐัะธั, ะณะธะฑัะธะดะฝัะน ะฟะพะธัะบ, ranking
- **ะะปััะตะฒะพะน ัะฐะนะป**: `chunks_hybrid_search.py`

### 5. LLM Agents Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/agents/`
- **ะคัะฝะบัะธั**: AI-ะฐะณะตะฝัั ะดะปั ะธััะปะตะดะพะฒะฐะฝะธั ะธ Q&A
- **ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั**: Researcher Agent, Q&A SubAgent

### 6. Connector Integration Layer
- **ะะตััะพะฟะพะปะพะถะตะฝะธะต**: `surfsense_backend/app/tasks/connector_indexers/`
- **ะคัะฝะบัะธั**: ะะฝะดะตะบัะฐัะธั ะธะท ะฒะฝะตัะฝะธั ะธััะพัะฝะธะบะพะฒ (Slack, GitHub, Notion, etc.)
- **ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะธััะพัะฝะธะบะธ**: 15+ ัะตัะฒะธัะพะฒ

## ะัะฐั ะทะฝะฐะฝะธะน ะธ ัะทะปั

ะ SurfSense ะณัะฐั ะทะฝะฐะฝะธะน ัะตะฐะปะธะทะพะฒะฐะฝ ัะตัะตะท:

### 1. **LangGraph State Graph**
ะฃะทะปั workflow ะดะปั orchestration AI ะฟัะพัะตััะพะฒ:
- `reformulate_user_query` - ััะฐะฝััะพัะผะฐัะธั ะทะฐะฟัะพัะฐ
- `handle_qna_workflow` - Q&A ะฟัะพัะตัั
- `rerank_documents` - ะฟะตัะตัะฐะฝะถะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ
- `answer_question` - ะณะตะฝะตัะฐัะธั ะพัะฒะตัะฐ
- `generate_further_questions` - follow-up ะฒะพะฟัะพัั

### 2. **Document-Chunk Graph**
ะะตัะฐััะธัะตัะบะฐั ััััะบัััะฐ ะทะฝะฐะฝะธะน:
- **Document** (ัะทะตะป ะฒะตััะฝะตะณะพ ััะพะฒะฝั) โ ัะพะดะตัะถะธั ะผะตัะฐะดะฐะฝะฝัะต, summary, embedding
- **Chunks** (ัะทะปั ะบะพะฝัะตะฝัะฐ) โ ัะฒัะทะฐะฝั ั Document, ะบะฐะถะดัะน ะธะผะตะตั embedding
- **Relationships** โ ัะตัะตะท foreign keys ะธ ะฒะตะบัะพัะฝะพะต ะฟัะพัััะฐะฝััะฒะพ

### 3. **Semantic Graph**
ะกะตะผะฐะฝัะธัะตัะบะธะต ัะฒัะทะธ ัะตัะตะท embeddings:
- ะะตะบัะพัะฝะพะต ะฟัะพัััะฐะฝััะฒะพ ัะพัะผะธััะตั ะฝะตัะฒะฝัะน ะณัะฐั ะฟะพัะพะถะตััะธ
- Cosine similarity ะพะฟัะตะดะตะปัะตั "ะฑะปะธะทะพััั" ัะทะปะพะฒ
- Hybrid search ัะพะทะดะฐะตั ะผะฝะพะณะพะผะตัะฝัะต ัะฒัะทะธ (semantic + lexical)

## ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

- **ะะฐะทะฐ ะดะฐะฝะฝัั**: PostgreSQL + pgvector
- **Embeddings**: OpenAI, Azure OpenAI, ะธะปะธ custom ะผะพะดะตะปะธ
- **Chunking**: Chonkie (RecursiveChunker, CodeChunker)
- **ETL**: Unstructured, LlamaCloud, Docling
- **LLM Orchestration**: LangGraph
- **LLM ะฟัะพะฒะฐะนะดะตัั**: 20+ (OpenAI, Anthropic, Google, Groq, Ollama, etc.)
- **Reranking**: Cohere, Pinecone
- **Search**: pgvector cosine similarity + PostgreSQL FTS

## ะกัััะบัััะฐ ะดะพะบัะผะตะฝัะฐัะธะธ

ะะฐะฝะฝะฐั ัะฟะตัะธัะธะบะฐัะธั ัะพััะพะธั ะธะท ัะปะตะดัััะธั ะดะพะบัะผะตะฝัะพะฒ:

1. **00-overview.md** (ัะตะบััะธะน) - ะะฑัะธะน ะพะฑะทะพั ะฐััะธัะตะบัััั
2. **01-document-ingestion.md** - ะะฐะณััะทะบะฐ ะธ ETL ะพะฑัะฐะฑะพัะบะฐ ะดะพะบัะผะตะฝัะพะฒ
3. **02-graph-architecture.md** - ะััะธัะตะบัััะฐ ะณัะฐัะฐ ะทะฝะฐะฝะธะน ะธ ัะทะปะพะฒ
4. **03-llm-agents.md** - ะฏะทัะบะพะฒัะต ะฐะณะตะฝัั ะธ ะธั ัะพะปะธ
5. **04-semantic-layer.md** - ะกะตะผะฐะฝัะธัะตัะบะฐั ะพะฑัะฐะฑะพัะบะฐ ะธ ะบะพะฝัะตะฟััะฐะปัะฝัะน ัะปะพะน
6. **05-embeddings-search.md** - ะะตะบัะพัะธะทะฐัะธั ะธ ะฟะพะธัะบ
7. **06-chunking-indexing.md** - Chunking ะธ ะธะฝะดะตะบัะฐัะธั
8. **07-connectors.md** - ะะฝัะตะณัะฐัะธั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั
9. **08-data-flow.md** - ะะตัะฐะปัะฝัะต ะดะธะฐะณัะฐะผะผั ะฟะพัะพะบะพะฒ ะดะฐะฝะฝัั

## ะะปััะตะฒัะต ะผะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

- **ะะตะดัะฟะปะธะบะฐัะธั**: SHA-256 hashing ะดะปั content + unique identifier
- **Embedding dimension**: 1536-3072 (ะทะฐะฒะธัะธั ะพั ะผะพะดะตะปะธ)
- **Chunk size**: Adaptive (ะฟะพ max_seq_length ะผะพะดะตะปะธ)
- **Search**: Hybrid RRF ั k=60
- **Reranking**: top_k*2 โ top_k (ัะปัััะตะฝะธะต precision)
- **Token optimization**: Binary search ะดะปั fit ะฒ context window

## ะะตะทะพะฟะฐัะฝะพััั ะธ ะธะทะพะปััะธั

- **User isolation**: ัะตัะตะท SearchSpace (multi-tenancy)
- **API key encryption**: ะดะปั LLM ะบะพะฝัะธะณััะฐัะธะน
- **Access control**: ะฝะฐ ััะพะฒะฝะต ะดะพะบัะผะตะฝัะพะฒ ะธ search spaces
- **Connector authentication**: OAuth2 ะธ API ัะพะบะตะฝั

## ะกะปะตะดัััะธะต ัะฐะณะธ

ะะปั ะดะตัะฐะปัะฝะพะณะพ ะฟะพะฝะธะผะฐะฝะธั ะบะฐะถะดะพะณะพ ะบะพะผะฟะพะฝะตะฝัะฐ, ะพะฑัะฐัะธัะตัั ะบ ัะพะพัะฒะตัััะฒัััะธะผ ัะฐะทะดะตะปะฐะผ ะดะพะบัะผะตะฝัะฐัะธะธ (01-08).
